var schoolArr = new Array();
var Entry = function () {
    var a = new Object();
    var loginhtml,area = ['690px', 'auto'],offset,pageii,jump = '';
    var page = {};
    var address=[{"p
        rateHeight = height / maxHeight;
        if( rateWidth > rateHeight ){
            param.width =  maxWidth;
            param.height = Math.round(height / rateWidth);
        }else{
            param.width = Math.round(width / rateHeight);
            param.height = maxHeight;
        }
    }
    param.left = Math.round((maxWidth - param.width) / 2);
    param.top = Math.round((maxHeight - param.height) / 2);
    return param;
}rovince":"北京","citylist":[{"name":"北京","arealist":[{"name":"北京工商大学"},{"name":"北京交通大学"},{"name":"北京航空航天大学"},{"name":"北京理工大学"},{"name":"北京师范大学"},{"name":"北京外国语大学"},{"name":"北京邮电大学"},{"name":"中国传媒大学"},{"name":"中国人民大学"},{"name":"中央财经大学"}]}]},{"province":"天津","citylist":[{"name":"天津","arealist":[{"name":"天津大学"},{"name":"天津财经大学"},{"name":"天津工业大学"},{"name":"天津商业大学"},{"name":"天津科技大学"},{"name":"河北工业大学"},{"name":"天津师范大学"}]}]},{"province":"河北","citylist":[{"name":"石家庄","arealist":[{"name":"河北科技大学"}]},{"name":"唐山","arealist":[{"name":"河北联合大学"}]}]},{"province":"山西","citylist":[{"name":"太原","arealist":[{"name":"山西财经大学"},{"name":"太原理工大学"},{"name":"中北大学"}]},{"name":"晋中","arealist":[{"name":"山西农业大学"}]}]},{"province":"内蒙古","citylist":[{"name":"呼和浩特","arealist":[{"name":"内蒙古农业大学"},{"name":"内蒙古师范大学"}]}]},{"province":"黑吉","citylist":[{"name":"哈尔滨","arealist":[{"name":"哈尔滨理工大学"},{"name":"哈尔滨商业大学"},{"name":"哈尔滨医科大学"},{"name":"黑龙江大学"},{"name":"哈尔滨工业大学"},{"name":"黑龙江科技大学"},{"name":"哈尔滨工程大学"}]},{"name":"长春","arealist":[{"name":"东北师范大学"},{"name":"长春理工大学"},{"name":"吉林大学"},{"name":"吉林财经大学"}]}]},{"province":"沈阳","citylist":[{"name":"沈阳","arealist":[{"name":"沈阳师范大学"},{"name":"沈阳航空航天大学"},{"name":"辽宁大学"},{"name":"沈阳建筑大学"},{"name":"东北大学"}]},{"name":"大连","arealist":[{"name":"大连海事大学"},{"name":"大连理工大学"},{"name":"东北财经大学"}]}]},{"province":"山东","citylist":[{"name":"济南","arealist":[{"name":"山东建筑大学"},{"name":"山东财经大学圣井校区"},{"name":"山东工艺美术学院"},{"name":"山东大学"},{"name":"济南大学"},{"name":"山东财经大学明水校区"},{"name":"山东师范大学"}]},{"name":"青岛","arealist":[{"name":"中国海洋大学"},{"name":"山东科技大学"},{"name":"中国石油大学（华东）"},{"name":"青岛理工大学"}]}]},{"province":"福建","citylist":[{"name":"福州","arealist":[{"name":"福建农林大学"},{"name":"福州大学"},{"name":"福建师范大学"}]},{"name":"泉州","arealist":[{"name":"国立华侨大学"}]},{"name":"厦门","arealist":[{"name":"厦门大学"}]}]},{"province":"江西","citylist":[{"name":"南昌","arealist":[{"name":"江西师范大学"},{"name":"南昌航空大学"},{"name":"江西财经大学"},{"name":"南昌大学"},{"name":"华东交通大学"}]}]},{"province":"浙江","citylist":[{"name":"杭州","arealist":[{"name":"浙江传媒学院"},{"name":"浙江工商大学"},{"name":"中国计量学院"},{"name":"杭州电子科技大学"},{"name":"浙江外国语学院"},{"name":"杭州师范大学"},{"name":"浙江工业大学"},{"name":"浙江大学"},{"name":"浙江大学城市学院"}]}]},{"province":"上海","citylist":[{"name":"上海","arealist":[{"name":"上海外国语大学"},{"name":"上海海事大学"},{"name":"华东理工大学"},{"name":"上海师范大学"},{"name":"上海海洋大学"},{"name":"上海大学"},{"name":"东华大学"},{"name":"上海交通大学"},{"name":"华东师范大学"},{"name":"上海财经大学"},{"name":"同济大学"},{"name":"上海对外经贸大学"}]}]},{"province":"湖北","citylist":[{"name":"武汉","arealist":[{"name":"文华学院"},{"name":"中南财经政法大学"},{"name":"江汉大学"},{"name":"湖北大学"},{"name":"武汉理工大学"},{"name":"华中师范大学武汉传媒学院"},{"name":"华中师范大学"},{"name":"华中农业大学"}]}]},{"province":"湖南","citylist":[{"name":"长沙","arealist":[{"name":"湖南师范大学"},{"name":"中南林业科技大学"},{"name":"湖南大学"},{"name":"中南大学"},{"name":"长沙理工大学"},{"name":"湖南商学院"}]}]},{"province":"河南","citylist":[{"name":"郑州","arealist":[{"name":"河南工业大学"},{"name":"郑州航空工业管理学院"},{"name":"郑州大学"},{"name":"华北水利水电大学"},{"name":"黄河科技大学"},{"name":"河南财经政法大学"}]},{"name":"开封","arealist":[{"name":"河南大学"}]}]},{"province":"广东","citylist":[{"name":"广东","arealist":[{"name":"广州大学"},{"name":"广东工业大学"},{"name":"广东金融院学"},{"name":"华南理工大学"},{"name":"华南农业大学"},{"name":"华南师范大学"},{"name":"中山大学（南校区）"},{"name":"北京师范大学珠海分校"},{"name":"广东外语外贸大学"},{"name":"中山大学东校区"}]}]},{"province":"广西","citylist":[{"name":"南宁","arealist":[{"name":"广西民族大学"},{"name":"广西财经学院"},{"name":"广西大学"}]},{"name":"桂林","arealist":[{"name":"桂林电子科技大学"},{"name":"广西师范大学"},{"name":"桂林理工大学"}]}]},{"province":"深海分区","citylist":[{"name":"海南","arealist":[{"name":"海南大学"},{"name":"海南经贸职业技术学院"}]},{"name":"深圳","arealist":[{"name":"深圳职业技术学院"},{"name":"深圳大学"}]}]},{"province":"陕西","citylist":[{"name":"西安","arealist":[{"name":"西安工程大学"},{"name":"西安电子科技大学"},{"name":"陕西师范大学"},{"name":"西安科技大学"},{"name":"陕西科技大学"},{"name":"西安邮电大学"},{"name":"西北工业大学"},{"name":"西北政法大学"},{"name":"西安建筑科技大学"},{"name":"西安工业大学"},{"name":"西安财经学院"},{"name":"西北大学"},{"name":"西安翻译学院"},{"name":"长安大学"},{"name":"西安理工大学"},{"name":"西安交通大学"},{"name":"西安外国语大学"}]},{"name":"杨凌","arealist":[{"name":"西北农林科技大学"}]}]},{"province":"甘青宁","citylist":[{"name":"兰州","arealist":[{"name":"兰州大学"},{"name":"兰州交通大学"}]}]},{"province":"新疆","citylist":[{"name":"乌鲁木齐","arealist":[{"name":"新疆财经大学"},{"name":"新疆大学"}]}]},{"province":"四川","citylist":[{"name":"成都","arealist":[{"name":"四川大学"},{"name":"西南交通大学"},{"name":"西南石油大学"},{"name":"西南财经大学"},{"name":"西南民族大学"},{"name":"四川师范大学"}]}]},{"province":"重庆","citylist":[{"name":"重庆","arealist":[{"name":"重庆大学"},{"name":"重庆科技学院"},{"name":"重庆工商大学"},{"name":"重庆交通大学"}]}]},{"province":"云贵","citylist":[{"name":"贵阳","arealist":[{"name":"贵州大学"}]},{"name":"昆明","arealist":[{"name":"云南大学滇池学院"}]}]},{"province":"江苏","citylist":[{"name":"南京","arealist":[{"name":"南京大学"},{"name":"南京邮电大学"},{"name":"南京财经大学"},{"name":"南京师范大学"},{"name":"南京林业大学"},{"name":"南京理工大学"},{"name":"南京艺术学院"},{"name":"南京审计学院"},{"name":"南京航空航天大学"},{"name":"东南大学"},{"name":"河海大学"}]},{"name":"常州","arealist":[{"name":"江苏理工学院"}]},{"name":"无锡","arealist":[{"name":"江南大学"}]},{"name":"苏州","arealist":[{"name":"苏州大学"}]},{"name":"扬州","arealist":[{"name":"扬州大学"}]},{"name":"徐州","arealist":[{"name":"中国矿业大学"}]}]},{"province":"安徽","citylist":[{"name":"合肥","arealist":[{"name":"合肥工业大学"},{"name":"安徽大学"},{"name":"安徽新华学院"},{"name":"安徽建筑大学"},{"name":"安徽农业大学"}]},{"name":"芜湖","arealist":[{"name":"皖南医学院"}]}]}];
    a.deny = a.deny || {};
    a.deny.object = {
        options: {
            uid:"",
            isSign:false,
            page:{},
            settings:{
                button_image_url: "public/images/upload-button.png",	// Relative to the Flash file
                button_width: "95",
                button_height: "35",
                button_placeholder_id: "spanButtonPlaceHolder"
            },
            showUrl:"http://ideaclub.lenovo.com.cn/forum/forum.php?mod=viewthread&tid=37138"
        }
    };
    return {
        init: function (d) {
            a = $.extend({}, a.deny.object.options, d);
            this.Judge();
        },
        box:function(){
            pageii = $.layer({
                type: 1,
                title: false,
                border : [0],
                bgcolor:'',
                move:false,
                area: area,
                closeBtn: [0, false], //去掉默认关闭按钮
                page: a.page
            });
        },
        login:function(){
            var $regFrom = $("#loginForm");
            // 表单验证
            $regFrom.validate({
                rules: {
                    account: {
                        required: true
                    },
                    password: {
                        required: true
                    }
                },
                messages: {
                    account: {
                        required: "请填写帐户名!"
                    },
                    password: {
                        required: "请填写密码!"
                    }
                },
                success: function(label) {

                }
            });
            $('#loginForm').ajaxForm({
                dataType: 'json',
                success: function(json) {
                    var loadi = layer.load(0);
                    if(json.result == "success"){
                        layer.closeAll();
                        if(json.isSign){
                            alert("您已参与活动！");
                            history.go(0);
                        }else{
                            $("#status").html('<A href="javascript:;" id="login" title="登陆" style="color:#fff;padding-right: 10px;">您好，'+json.username+'</A> <A href="index.php?f=index&c=quit" title="退出"><img src="public/images/btn3-1.png"></A>');
                            if(jump != ""){
                                window.location = jump;
                            }else{
                                history.go(0);
                            }
                        }
                    }else{
                        layer.closeLoad();
                        alert(json.msg);
                    }
                }
            });
            $("#reg").click(function(){
                layer.close(pageii);
                area = ['910px','560px'];
                a.page.url = 'index.php?f=register'
                a.page.ok = function(datas){
                    Entry.register();
                }
                Entry.box();
            });
            $(".close").click(function(){
                layer.close(pageii);
            });
        },
        register:function(){
            var $regFrom = $("#regForm");
            // 表单验证
            $regFrom.validate({
                rules: {
                    email: {
                        required: true,
                        email: true,
                        remote: "index.php?f=register"
                    },
                    username: {
                        required: true,
                        userName:true,
                        remote: "index.php?f=register"
                    },
                    password: {
                        required: true,
                        regexPassword: true
                    },
                    confirm_password: {
                        required: true,
                        equalTo: "#password"
                    },
                    code: {
                        required: true,
                        code: true
                    }
                },
                messages: {
                    email: {
                        required: "请输入邮箱地址!",
                        email: "请输入正确的邮箱地址",
                        remote: "该E-mail已存在"
                    },
                    username: {
                        required: "请输入用户名",
                        remote: "该用户名已被占用"
                    },
                    password: {
                        required: "请填写密码!"
                    },
                    confirm_password: {
                        required: "请填写确认密码",
                        equalTo: "两次输入密码不一致"
                    },
                    code: {
                        required: "请填写验证码"
                    }
                },
                success: function(label) {

                }
            });
            $("#getcode_char,#r").click(function(){
                $("#getcode_char").attr("src",'verifycode.php?' + Math.random());
            });
            $('#regForm').ajaxForm({
                dataType: 'json',
                success: function(json) {
                    var loadi = layer.load(0);
                    if(json.result == "success"){
                        layer.close(pageii);
                        if(json.isSign){
                            alert("您已参与");
                            history.go(0);
                        }else{
                            history.go(0);
                        }
                    }else{
                        layer.closeLoad();
                        alert(json.msg);
                    }
                }
            });
            $(".close").click(function(){
                layer.close(pageii);
            });
        },
        list:function(){
            area = ['910px','560px'];
            a.page.url = 'index.php?f=list'
            a.page.ok = function(datas){
                $('#scrollbar6').tinyscrollbar();
                $(".close").click(function(){
                    layer.close(pageii);
                });
            }
            Entry.box();
        },
        signup:function(){
            var $signFrom = $("#signUpform"),$signFrom2 = $("#signUpform2");
            if($("#spanButtonPlaceHolder").length > 0){
                var swfu;
                a.settings.flash_url = "public/js/swfupload/swfupload.swf";
                a.settings.upload_url = "../../../index.php?f=upload";
                a.settings.post_params = {"ajax" : "2"};
                a.settings.file_size_limit = "150 MB";
                a.settings.file_types = "*.apk";
                a.settings.file_types_description = "All Files";
                a.settings.button_action = SWFUpload.BUTTON_ACTION.SELECT_FILE;
                a.settings.button_window_mode = SWFUpload.WINDOW_MODE.TRANSPARENT;
                a.settings.file_queued_handler = Entry.Handler.fileQueued;
                a.settings.file_queue_error_handler = Entry.Handler.fileQueueError;
                a.settings.file_dialog_complete_handler = Entry.Handler.fileDialogComplete;
                a.settings.upload_complete_handler = Entry.Handler.uploadComplete;
                a.settings.upload_start_handler = Entry.Handler.uploadStart;
                a.settings.upload_progress_handler = Entry.Handler.uploadProgress;
                a.settings.upload_success_handler = Entry.Handler.uploadSuccess;
                swfu = new SWFUpload(a.settings);
            }
            // 表单验证
            $signFrom.validate({
                ignore: "",
                rules: {
                    area: {
                        required: true
                    },
                    city: {
                        required: true
                    },
                    school: {
                        required: true
                    },
                    team:{
                        required: true
                    },
                    team_number:{
                        required: true
                    },
                    code:{
                        required: true
                    }
                },
                messages: {
                    area: {
                        required: "请选择地区!"
                    },
                    city: {
                        required: "请选择城市!"
                    },
                    school: {
                        required: "请选择学校!"
                    },
                    team: {
                        required: "请输入团队名称!"
                    },
                    team_number:{
                        required: "至少输入一个队员信息"
                    },
                    code:{
                        required: "请输入验证码"
                    }
                },
                errorPlacement: function(error, element) {
                    if(element.attr("name") == "area" || element.attr("name") == "city" || element.attr("name") == "school"){
                        $(".error-msg").html("请选择学校和地区");
                    }else if(element.attr("name") == "team_number"){
                        $(".error-msg2").html("至少输入一个队员信息");
                    }else{
                        element.attr("placeholder",error.text());
                        console.log();
                    }
                }
            });
            $signFrom2.validate({
                ignore: "",
                rules: {
                    work_name: {
                        required: true,
                        maxlength: 20
                    },
                    brief:{
                        required: true,
                        maxlength: 500
                    },
                    "apk_name":{
                        required: true
                    },
                    "sm":{
                        required: true
                    },
                    "pic_path":{
                        required: true
                    }
                },
                messages: {
                    work_name: {
                        required: "请输入作品名称!",
                        maxlength: "作品名称不能超过20字符"
                    },
                    brief: {
                        required: "请输入简介",
                        maxlength: "请输入500字符以内的文字"
                    },
                    "apk_name":{
                        required: "请上传APK"
                    },
                    "sm":{
                        required: "请阅读法律声明"
                    },
                    "pic_path":{
                        required: "至少上传一张图片"
                    }
                }
            });
            $('#signUpform,#signUpform2').ajaxForm({
                dataType: 'json',
                success: function(json) {
                    var rE = json.r_e;
                    var	rC = json.r_c;
                    if(rE == 0) {
                        area = ['550px','300px'];
                        a.page.html = '<div class="box" style="width:550px;height:300px;"><div class="dl_body"><h1><img src="public/images/box-logo.png" /><font>茄子快传</font></h1><div class="dl_box" style="padding-bottom:20px;color:#fff;text-align:center;"><p style="line-height:120px;">'+rC+'</p><img src="public/images/qd.png" class="qd" style="cursor: pointer;" /></div></div><a class="close" title="关闭">关闭</a></div>';
                        Entry.box();
                        $(".close,.qd").click(function(){
                            layer.close(pageii);
                            a.page.html = "";
                            history.go(0);
                        });
                    } else {
                        alert(rC);
                    }
                }
            });
            Entry.sendCode();
            $("#sm").click(function(){
                area = ['880px','600px'];
                a.page.html = '<div class="box" style="width:880px;height:auto;"><div class="dl_body"><h1><img src="public/images/box-logo.png" /><font>法律声明</font></h1><div class="dl_box" style="padding-bottom:20px;"><p><img src="public/images/text-icon-10.png" /><img src="public/images/ty.png" class="ty" style="cursor: pointer;" /></p></div></div><a class="close" title="关闭">关闭</a></div>';
                Entry.box();
                $(".ty").click(function(){
                    $("input[name='sm']").prop("checked",true);
                    $(".close").click();
                });
                $(".close").click(function(){
                    layer.close(pageii);
                    a.page.html = "";
                });
            });
            $(".click").click(function(){
                var type = $(this).attr("data-type");
                var name = $(this).attr("data-name");
                var font = $(this).parent().find("font");
                var html = font.html();
                html = html.replace(/<br\s*\/?>/g, "\n");
                if(type == "input"){
                    font.html('<input type="text" name="'+name+'" value="'+html+'" />');
                }
                if(type == "textarea"){
                    font.html('<textarea class="textarea" name="'+name+'">'+html+'</textarea>');
                }
                $(this).unbind("click");
//                $(this).addClass("unClick").removeClass("click");
//                $(".unClick").click(function(){
//                    var font = $(this).parent().find("font").find("input,textarea");
//                    $(this).parent().find("font").html(font.val());
//                    $(this).addClass("click").removeClass("unClick");
//                });
            });
        },
        sendCode:function(){
            $("#sendCode").click(function(){
                var mobile = $("#mobile").val();
                if(mobile == ""){
                    area = ['550px','300px'];
                    a.page.html = '<div class="box" style="width:550px;height:300px;"><div class="dl_body"><h1><img src="public/images/box-logo.png" /><font>茄子快传</font></h1><div class="dl_box" style="padding-bottom:20px;color:#fff;text-align:center;"><p style="line-height:120px;">请先输入领队手机号！</p><img src="public/images/qd.png" class="qd" style="cursor: pointer;" /></div></div><a class="close" title="关闭">关闭</a></div>';
                    Entry.box();
                    $(".close,.qd").click(function(){
                        layer.close(pageii);
                        a.page.html = "";
                    });
                }else{
                    if(!mobile.match(/^(13|14|15|17|18)[0-9]{9}$/)){
                        area = ['550px','300px'];
                        a.page.html = '<div class="box" style="width:550px;height:300px;"><div class="dl_body"><h1><img src="public/images/box-logo.png" /><font>茄子快传</font></h1><div class="dl_box" style="padding-bottom:20px;color:#fff;text-align:center;"><p style="line-height:120px;">手机号格式错误！</p><img src="public/images/qd.png" class="qd" style="cursor: pointer;" /></div></div><a class="close" title="关闭">关闭</a></div>';
                        Entry.box();
                        $(".close,.qd").click(function(){
                            layer.close(pageii);
                            a.page.html = "";
                        });
                    }else{
                        $.ajax({
                            type: 'POST',
                            url: 'index.php?f=signup&on=resertAuthCode',
                            data: 'mobile='+mobile,
                            dataType: 'json',
                            error: function(){
                                alert('出错了！');
                                return false;
                            },
                            success:function(json){
                                if(json.r_e == 0) {
                                    area = ['550px','300px'];
                                    a.page.html = '<div class="box" style="width:550px;height:300px;"><div class="dl_body"><h1><img src="public/images/box-logo.png" /><font>茄子快传</font></h1><div class="dl_box" style="padding-bottom:20px;color:#fff;text-align:center;"><p style="line-height:120px;">短信已发送，请查收</p><img src="public/images/qd.png" class="qd" style="cursor: pointer;" /></div></div><a class="close" title="关闭">关闭</a></div>';
                                    Entry.box();
                                    $(".close,.qd").click(function(){
                                        layer.close(pageii);
                                        a.page.html = "";
                                    });
                                    return false;
                                } else {
                                    if(json.r_e == 100010) {
                                        alert(json.r_c);
                                    } else {
                                        alert('发送失败');
                                    }
                                    return false;
                                }
                            }
                        });
                    }
                }
            });
        },
        scroll:function(){
            $(document.body).append('<div id="elevator_item" style="width: 50px;height: 151px;position: fixed;right: 30px;bottom: 300px;-webkit-transition: opacity .4s ease-in-out;-moz-transition: opacity .4s ease-in-out;-o-transition: opacity .4s ease-in-out;opacity: 1;z-index: 100020;display: none;background: url(public/images/icon-bg.png) center top no-repeat;"><a class="home" href="./" title="返回首页"></a><a class="share" title="分享"></a><a id="elevator" onclick="return false;" title="回到顶部"></a></div>');
            $(window).scroll(function(){
                var scrolltop=$(this).scrollTop();
                if(scrolltop>=200){
                    $("#elevator_item").show();
                }else{
                    $("#elevator_item").hide();
                }
            });
            bShare.addEntry({
                title: "联想平板S8-50“想+”粉丝专场",
                url: "http://ideaclub.lenovo.com.cn/",
                summary: "联想平板S8-50“想+”粉丝专场",
                pic: "pic.png"
            });
            $(".share").click(function(){
                var type = $(this).attr("data-type");
                bShare.viewcb({"v":"1CHCUCsRCWQ0eKqOuqx8","c":0,"p":[95,86,24,998,75,157,77,2,152,99,114,108,84,97,1,184,3]});
                bShare.more(event);
            });
            $("#elevator").click(function(){
                $("html,body").animate({scrollTop: 0}, 500);
            });
        },
        Judge:function(){
            $("#login").bind("click",function(){
                if(a.uid){
                    alert("请选择派系");
                }else{
                    area = ['690px','400px'];
                    a.page.url = 'index.php?f=login'
                    a.page.ok = function(datas){
                        Entry.login();
                    }
                }
                Entry.box();
            });
            $("#register").bind("click",function(){
                area = ['910px','560px'];
                a.page.url = 'index.php?f=register'
                a.page.ok = function(datas){
                    Entry.register();
                }
                Entry.box();
            });
            $(".upload").bind("click",function(){
                if(a.uid){
                    window.location = "index.php?f=signup";
                }else{
                    area = ['690px','400px'];
                    a.page.url = 'index.php?f=login'
                    a.page.ok = function(datas){
                        jump = "index.php?f=signup";
                        Entry.login();
                    }
                    Entry.box();
                }
            });
             $(".dianzan").bind("click",function(){
               /* if(a.uid){
                    
                }else{
                    area = ['690px','400px'];
                    a.page.url = 'index.php?f=login'
                    a.page.ok = function(datas){
                        jump = "index.php";
                        Entry.login();
                    }
                    Entry.box();
                }*/
            });
            $(".update").bind("click",function(){
                if(a.uid){
                    if(a.isSign){
                        window.location = "index.php?f=update";
                    }else{
                        alert("请先上传作品！");
                        window.location = "index.php?f=signup";
                    }
                }else{
                    area = ['690px','400px'];
                    a.page.url = 'index.php?f=login'
                    a.page.ok = function(datas){
                        jump = "index.php?f=update";
                        Entry.login();
                    }
                    Entry.box();
                }
            });
            $("#thread_types li a").each(function(i){
                $(this).click(function(){
                    var href = $(this).attr("href");
                    var id = $(this).parent().attr("id");
                    $("#thread_types li").attr("class","");
                    if(id == i){
                        $(this).parent().attr("class","xw1 a");
                    }
                    tabNav(href);
                    event.preventDefault();
                });
            });
            $(".sdk").click(function(){
                area = ['690px','600px'];
                a.page.html = '<div class="box width" style="height:auto;"><div class="dl_body"><h1><img src="public/images/box-logo.png" /><font>SDK开发包说明</font></h1><div class="dl_box" style="position: relative;padding-bottom:20px;"><p><img src="public/images/text-icon-9.png" /><a href="http://www.zasv.com/ShareIt_gamecenter_SDK-v1.0.1.rar" target="_blank" class="down"><img src="public/images/down-button.png" /></a></p></div></div><a class="close" title="关闭">关闭</a></div>';
                Entry.box();
                $(".close").click(function(){
                    layer.close(pageii);
                    a.page.html = "";
                });
            });
            $(".clickheader").css("cursor","pointer");
            $(".clickheader").click(function(){
                window.location = "./";
            });
            newSpec();
            $("#oldUserAddres").focus(function(){
                if($("#js_city").val() != ""){
                    $("#oldUserAddres").suggest(schoolArr,{hot_list:schoolArr,attachObject:"#scrollbar2 .overview"});
                    $(document).on("click",".chooseList dd",function(){
                        var selectRang = $(this).closest(".subSelect")
                        var txt = $(this).text();
                        selectRang.find(".dropUl").removeClass("show")
                        selectRang.find(".inputStyle").val(txt);
                    });
                }
            });
        },
        getFileSize: function(num) {
            if (isNaN(num)) {
                return false;
            }
            num = parseInt(num);
            var units = [ " B", " KB", " MB", " GB" ];
            for ( var i = 0; i < units.length; i += 1) {
                if (num < 1024) {
                    num = num + "";
                    if (num.indexOf(".") != -1 && num.indexOf(".") != 3) {
                        num = num.substring(0, 4);
                    } else {
                        num = num.substring(0, 3);
                    }
                    break;
                } else {
                    num = num / 1024;
                }
            }
            return num + units[i];
        },
        updateStatus: function(fileId, html) {
            $(".bar").css("width",html);
            $(".text-bar").text(html);
            if(html == "100%"){
                $("#photo-uploader").html("请稍后...");
                $(".text-bar").text("请稍后...");
            }else{
                $("#photo-uploader").html(html);
            }
        },
        Handler: {
            fileQueued: function(file) {
                $(".bar").css("width","0%");
                $("#photo-uploader").html("0%").addClass("uploadBar");
            },
            fileDialogComplete:function(file){
                this.startUpload();
            },
            uploadStart: function(file) {
                //开始上传此文件
                Entry.updateStatus(file.id,"开始上传");
                $("#apk_name").val("");
            },
            uploadProgress: function(file, bytesLoaded, bytesTotal) {
                var percent = Math.ceil((bytesLoaded / bytesTotal) * 100);
                Entry.updateStatus(file.id, percent + "%");
            },
            uploadSuccess: function(file, serverData) {
                var data = eval("("+serverData+")");
                if(data.success == "true"){
                    $("#apk_name").val(data.filepath);
                    $(".text-bar").text("上传完成！");
                    $("#photo-uploader").html("上传完成！");
                }else{
                    alert(data.error);
                }
            },
            fileQueueError: function(file, errorCode, message) {
                switch (errorCode) {
                    default:
                        alert(message);
                        break;
                }
                console.log(file);
                console.log(errorCode);
                console.log(message);
            }
        },
        writeArea:function(province, city, school) {
            var option = "";
            var citylist = [];
            var arealist = [];
            jQuery("#js_province").append('<option value="" selected="selected">请选择选择地区</option>');
            jQuery("#js_city").append('<option value="" selected="selected">请选择城市</option>');
            jQuery("#js_area").append('<option value="" selected="selected">请选择学校</option>');
            for(i=0; i<address.length; i++) {
                option = '';
                if(address[i].province == province){
                    jQuery("#js_province").append('<option selected="selected" value="'+ address[i].province +'">'+ address[i].province +'</option>');
                    citylist = address[i].citylist;
                    for(j=0; j<citylist.length; j++) {
                        if(citylist[j].name == city) {
                            option = ' selected="selected"';
                            jQuery("#js_city").append('<option selected="selected" value="'+ citylist[j].name +'">'+ citylist[j].name +'</option>');
                            arealist = citylist[j].arealist;
                            for(k=0; k<arealist.length; k++) {
                                if(arealist[k].name == school) {
                                    option = ' selected="selected"';
                                } else {
                                    option = '';
                                }
                                schoolArr[k] = new Array('BJ',arealist[k].name,'BEIJING','BJ');
                                jQuery("#js_area").append('<option '+ option +' value="'+ arealist[k].name +'">'+ arealist[k].name +'</option>');
                            }
                        } else {
                            jQuery("#js_city").append('<option value="'+ citylist[j].name +'">'+ citylist[j].name +'</option>');
                        }
                    }
                } else {
                    jQuery("#js_province").append('<option value="'+ address[i].province +'">'+ address[i].province +'</option>');
                }
            }
            if($("#oldUserAddres").length > 0){
                $("#oldUserAddres").suggest(schoolArr,{hot_list:schoolArr,attachObject:"#scrollbar2 .overview"});
                $(document).on("click",".chooseList dd",function(){
                    var selectRang = $(this).closest(".subSelect")
                    var txt = $(this).text();
                    selectRang.find(".dropUl").removeClass("show")
                    selectRang.find(".inputStyle").val(txt);
                });
            }
        },
        returnArr:function(){
            return address;
        }
    };
}();
$(function(){
    jQuery.validator.addMethod("isIdCardNo", function (value, element) {
        return this.optional(element) || isIdCardNo(value);
    }, "请正确输入身份证号码");
    jQuery.validator.addMethod("isMobile", function(value, element) {
        var length = value.length;
        return this.optional(element) || (length == 11 && /^(13|14|15|17|18)[0-9]{9}$/i.test(value));
    }, "请正确填写手机号码。");
    jQuery.validator.addMethod("userName", function(value, element,param) {
        var length = value.length;
        for(var i = 0; i < value.length; i++){
            if(value.charCodeAt(i) > 127){
                length++;
            }
        };
        return this.optional(element) || (length > 3 && /^[\u0391-\uFFE5\w]+$/.test(value));
    }, "用户名只能包括中文字、英文字母、数字和下划线，长度不小于4个字节");
    jQuery.validator.addMethod("regexPassword", function(value, element) {
        return this.optional(element) || /^[A-Za-z0-9_+=-]{6,16}$/.test(value);
    }, "密码只能包括数字,大小写英文字母,下划线_,等于号=,加减号+-,6-16位字符");
    jQuery.validator.addMethod("code", function(value, element) {
        return this.optional(element) || /^[a-z0-9]{4,4}$/.test(value);
    }, "验证码为4位数字+英文字母");
    //增加身份证验证
    function isIdCardNo(num) {
        var factorArr = new Array(7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2, 1);
        var parityBit = new Array("1", "0", "X", "9", "8", "7", "6", "5", "4", "3", "2");
        var varArray = new Array();
        var intValue;
        var lngProduct = 0;
        var intCheckDigit;
        var intStrLen = num.length;
        var idNumber = num;
        // initialize
        if ((intStrLen != 15) && (intStrLen != 18)) {
            return false;
        }
        // check and set value
        for (i = 0; i < intStrLen; i++) {
            varArray[i] = idNumber.charAt(i);
            if ((varArray[i] < '0' || varArray[i] > '9') && (i != 17)) {
                return false;
            } else if (i < 17) {
                varArray[i] = varArray[i] * factorArr[i];
            }
        }
        if (intStrLen == 18) {
            //check date
            var date8 = idNumber.substring(6, 14);
            if (isDate8(date8) == false) {
                return false;
            }
            // calculate the sum of the products
            for (i = 0; i < 17; i++) {
                lngProduct = lngProduct + varArray[i];
            }
            // calculate the check digit
            intCheckDigit = parityBit[lngProduct % 11];
            // check last digit
            if (varArray[17] != intCheckDigit) {
                return false;
            }
        }
        else {        //length is 15
            //check date
            var date6 = idNumber.substring(6, 12);
            if (isDate6(date6) == false) {
                return false;
            }
        }
        return true;
    }
    function isDate6(sDate) {
        if (!/^[0-9]{6}$/.test(sDate)) {
            return false;
        }
        var year, month, day;
        year = sDate.substring(0, 4);
        month = sDate.substring(4, 6);
        if (year < 1700 || year > 2500) return false
        if (month < 1 || month > 12) return false
        return true
    }

    function isDate8(sDate) {
        if (!/^[0-9]{8}$/.test(sDate)) {
            return false;
        }
        var year, month, day;
        year = sDate.substring(0, 4);
        month = sDate.substring(4, 6);
        day = sDate.substring(6, 8);
        var iaMonthDays = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]
        if (year < 1700 || year > 2500) return false
        if (((year % 4 == 0) && (year % 100 != 0)) || (year % 400 == 0)) iaMonthDays[1] = 29;
        if (month < 1 || month > 12) return false
        if (day < 1 || day > iaMonthDays[month - 1]) return false
        return true
    }
});
function changProvince(){
    var address = Entry.returnArr();
    for(i=0; i<address.length; i++) {
        var citylist = address[i].citylist;
        if(address[i].province == jQuery("#js_province").val()){
            jQuery("#js_city").empty();
            jQuery("#js_city").append('<option value="">请选择城市</option>');
            jQuery("#js_area").empty();
            jQuery("#js_area").append('<option value="" selected="selected">请选择学校</option>');
            for(j=0; j<citylist.length; j++){
                jQuery("#js_city").append('<option value="'+ citylist[j].name +'">'+ citylist[j].name +'</option>');
            }
        }
    }
}
function changCity(){
    var address = Entry.returnArr();
    for(i=0; i<address.length; i++) {
        var citylist = address[i].citylist;
        if(address[i].province == jQuery("#js_province").val()){
            for(j=0; j<citylist.length; j++){
                if(citylist[j].name == jQuery("#js_city").val()) {
                    var arealist = citylist[j].arealist;
                    jQuery("#js_area").empty();
                    jQuery("#js_area").append('<option value="">请选择学校</option>');
                    for(a=0; a<arealist.length; a++) {
                        schoolArr[a] = new Array('BJ',arealist[a].name,'BEIJING','BJ');
                        jQuery("#js_area").append('<option value="'+ arealist[a].name +'">'+ arealist[a].name +'</option>');
                    }
                }
            }
        }
    }
    $(".inputStyle").val("");
}
function newSpec(){
    var newspecial = document.getElementById("newspecial");
    if(newspecial != null){
        newspecial.setAttribute('onclick',document.all &&　!document.documentMode ? eval(function(){show()}) : 'javascript:show()');
        newspecial.setAttribute('onmouseover',document.all &&　!document.documentMode ? eval(function(){show()}) : '');
    }
}
function show(){
    window.open('http://ideaclub.lenovo.com.cn/forum/forum.php?mod=post&action=newthread&fid=98');
}
function checkForumnew_btn(id){
    tabNav("http://ideaclub.lenovo.com.cn/forum/forum.php?mod=forumdisplay&fid="+id);
}
function showMenu(id){

}
function tabNav(url){
    $.ajax({
        type: "POST",
        url: "index.php?f=index",
        data: {mod:url},
        dataType: "json",
        success: function(data){
            var length = data.list.length;
            var html = new Array();
            html.push('<table summary="forum_98" cellspacing="0" cellpadding="0">');
            html.push('<tbody><tr><td style="width: 1px;"></td><th></th><td class="by"></td><td class="num"></td><td class="by"></td></tr></tbody>');
            for(var i=0;i<length;i++){
                html.push('<tbody><tr><td></td>');
                html.push('<th class="common">'+data.list[i]+'</th>');
                html.push('<td class="by"><cite>'+data.author[i]+'</cite></td>');
                html.push('<td class="num">'+data.view[i]+'</td>');
                html.push('<td class="by">'+data.data[i]+'</td>');
                html.push('</tr></tbody>');
            }
            html.push("</table>");
            var div = $(html.join(""));
            $(".clist").html(div);
            newSpec();
        }
    });
}
function getTeams(obj){
    var i=0;
    $(obj).parent().find("input[type='text']").each(function(){
        if($(this).val() != ""){
            i++;
        }else{
            i--;
        }
    });
    if(i == 3){
        $("#team_number").val("1");
        $(".error-msg2").hide();
        i = 0;
    }else{
        $("#team_number").val("");
        $(".error-msg2").show();
        i = 0;
    }
    if($(obj).val() != ""){
        $(obj).parent().find("input[type='text']").eq(0).rules("add", { required: true, messages: { required: "请输入姓名"} });
        $(obj).parent().find("input[type='text']").eq(1).rules("add", { required: true,isIdCardNo:true, messages: { required: "请输入身份证号码"} });
        $(obj).parent().find("input[type='text']").eq(2).rules("add", { required: true,isMobile:true, messages: { required: "请输入手机号码"} });
    }else{
        $(obj).parent().find("input[type='text']").eq(0).rules("remove");
        $(obj).parent().find("input[type='text']").eq(1).rules("remove");
        $(obj).parent().find("input[type='text']").eq(2).rules("remove");
    }
}
function getTeam(obj){
    var i=0;
    $(obj).parent().find("input[type='text']").each(function(){
        if($(this).val() != ""){
            i++;
        }else{
            i--;
        }
    });
    if($(obj).val() != ""){
        $(obj).parent().find("input[type='text']").eq(0).rules("add", { required: true, messages: { required: "请输入姓名"} });
        $(obj).parent().find("input[type='text']").eq(1).rules("add", { required: true,isIdCardNo:true, messages: { required: "请输入身份证号码"} });
        $(obj).parent().find("input[type='text']").eq(2).rules("add", { required: true,isMobile:true, messages: { required: "请输入手机号码"} });
    }else{
        $(obj).parent().find("input[type='text']").eq(0).rules("remove");
        $(obj).parent().find("input[type='text']").eq(1).rules("remove");
        $(obj).parent().find("input[type='text']").eq(2).rules("remove");
    }
}
function get(obj){
    var maxsize = 400*1024;//400KB
    var errMsg = "单张图片不能超过400KB！！！";
    var tipMsg = "您的浏览器暂不支持计算上传文件的大小，确保上传文件不要超过2M，建议使用IE、FireFox、Chrome浏览器。";
    var  browserCfg = {};
    var ua = window.navigator.userAgent;
    if(ua.indexOf("MSIE")>=1){
        browserCfg.ie = true;
    }else if(ua.indexOf("Firefox")>=1){
        browserCfg.firefox = true;
    }else if(ua.indexOf("Chrome")>=1){
        browserCfg.chrome = true;
    }
    try{
        var obj_file = obj;
        var state = document.getElementById("state");
        var strExtension = obj_file.value.substr(obj_file.value.lastIndexOf('.') + 1);
        var filesize = 0;
        if(browserCfg.firefox || browserCfg.chrome ){
            filesize = obj_file.files[0].size;
        }else if(browserCfg.ie){
            var obj_img = document.getElementById('tempimg');
            obj_img.dynsrc=obj_file.value;
            filesize = obj_img.fileSize;
        }else{
            alert(tipMsg);
            return false;
        }
        if(filesize==-1){
            alert(tipMsg);
            return false;
        }else if(strExtension != 'jpg' && strExtension != 'gif' && strExtension != 'png' && strExtension != 'bmp'){
            alert("文件类型不正确");
            return false;
        }else if(filesize>maxsize){
            alert(errMsg);
            return false;
        }else{
            $("#pic_path").val("1");
            $(obj).parent().parent().find(".input").text($(obj).val());
            return false;
        }
    }catch(e){
        alert(e);
    }
}
function previewImage(file,id){
    var MAXWIDTH  = 100;
    var MAXHEIGHT = 100;
    var div = document.getElementById("preview"+id);
    if (file.files && file.files[0]){
        div.innerHTML = '<img id=imghead'+id+'>';
        var img = document.getElementById('imghead'+id);
        img.onload = function(){
            var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
            img.width = rect.width;
            img.height = rect.height;
            img.style.marginTop = rect.top+'px';
        }
        var reader = new FileReader();
        reader.onload = function(evt){img.src = evt.target.result;}
        reader.readAsDataURL(file.files[0]);
    }else{
        var sFilter='filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src="';
        file.select();
        var src = document.selection.createRange().text;
        div.innerHTML = '<img id=imghead>';
        var img = document.getElementById('imghead');
        img.filters.item('DXImageTransform.Microsoft.AlphaImageLoader').src = src;
        var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
        status =('rect:'+rect.top+','+rect.left+','+rect.width+','+rect.height);
        div.innerHTML = "<div id=divhead style='width:"+rect.width+"px;height:"+rect.height+"px;margin-top:"+rect.top+"px;"+sFilter+src+"\"'></div>";
    }
}
function clacImgZoomParam( maxWidth, maxHeight, width, height ){
    var param = {top:0, left:0, width:width, height:height};
    if( width>maxWidth || height>maxHeight ){
        rateWidth = width / maxWidth;
